<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „êµ­ ì„íƒ„í™”ë ¥ë°œì „ì†Œ ì‹ ì¬ìƒ ì—ë„ˆì§€ ì „í™˜ ì¢…í•© ë¶„ì„ (61ê¸°)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background: linear-gradient(135deg, #0066cc 0%, #004c99 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            padding: 30px 20px;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .header .subtitle {
            font-size: 1em;
            margin-top: 10px;
            opacity: 0.8;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .map-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .map-section h2 {
            color: #0066cc;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #0066cc;
            padding-bottom: 10px;
        }

        #map {
            height: 650px;
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* ë§ˆì»¤ ì‹œê°í™” ëª¨ë“œ ì „í™˜ */
        .map-mode-toggle {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #0066cc;
        }

        .map-mode-toggle h4 {
            color: #0066cc;
            margin-bottom: 12px;
            font-size: 1em;
        }

        .toggle-buttons {
            display: flex;
            gap: 10px;
        }

        .toggle-btn {
            flex: 1;
            padding: 12px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 500;
        }

        .toggle-btn:hover {
            border-color: #0066cc;
            background: #e3f2fd;
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
            color: white;
            border-color: #0066cc;
        }

        /* ë²”ë¡€ */
        .legend {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            margin-top: 20px;
            border: 2px solid #0066cc;
        }

        .legend h4 {
            color: #0066cc;
            margin-bottom: 12px;
            font-size: 1.1em;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 5px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            margin-right: 12px;
        }

        .legend-text {
            font-size: 0.95em;
            color: #333;
        }

        .legend-mode {
            display: none;
        }

        .legend-mode.active {
            display: block;
        }

        .chart-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: 700px;
        }

        .chart-section h2 {
            color: #0066cc;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #0066cc;
            padding-bottom: 10px;
        }

        .welcome-message {
            text-align: center;
            padding: 100px 20px;
            color: #666;
        }

        .welcome-message .icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .welcome-message h3 {
            font-size: 1.8em;
            margin-bottom: 15px;
            color: #0066cc;
        }

        .location-info {
            background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
        }

        .plant-count-badge {
            background: rgba(255,193,7,0.9);
            color: #333;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .lng-badge {
            background: rgba(255,152,0,0.9);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            display: inline-block;
            font-size: 0.85em;
            margin-left: 10px;
        }

        .location-subtitle {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }

        .total-score-card {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(255,215,0,0.4);
            border: 3px solid #FFD700;
        }

        .total-score-label {
            font-size: 1em;
            color: #333;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .total-score-value {
            font-size: 2.5em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .env-variables {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .env-card {
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s;
        }

        .env-card:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }

        .env-label {
            font-size: 0.8em;
            opacity: 0.85;
            margin-bottom: 5px;
            display: block;
        }

        .env-value {
            font-size: 1.3em;
            font-weight: bold;
            display: block;
        }

        .chart-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #e0e0e0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            background: #d0d0d0;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
            color: white;
        }

        .chart-wrapper {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid #e3f2fd;
            box-shadow: 0 2px 8px rgba(0,102,204,0.08);
            display: none;
        }

        .chart-wrapper.active {
            display: block;
        }

        .chart-header {
            background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 8px 8px 0 0;
            margin: -25px -25px 20px -25px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .chart-description {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #555;
        }

        .ranking-info {
            background: linear-gradient(to bottom, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .ranking-badge {
            display: inline-block;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.3em;
            margin: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .rank-1 {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
        }

        .rank-2 {
            background: linear-gradient(135deg, #C0C0C0 0%, #999999 100%);
            color: white;
        }

        .rank-3 {
            background: linear-gradient(135deg, #CD7F32 0%, #B8733D 100%);
            color: white;
        }

        .rank-other {
            background: #e0e0e0;
            color: #666;
        }

        /* Leaflet ë§ˆì»¤ */
        .custom-marker {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.7em;
            box-shadow: 0 3px 10px rgba(0,0,0,0.4);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            line-height: 1.1;
        }

        .custom-marker:hover {
            transform: scale(1.25);
            z-index: 1000 !important;
            box-shadow: 0 5px 15px rgba(0,0,0,0.6);
        }

        .custom-marker.active {
            animation: pulse 1.5s infinite;
            border-color: #FFD700;
            border-width: 4px;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        .footer {
            text-align: center;
            color: white;
            padding: 30px 20px;
            margin-top: 50px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>âš¡ ì „êµ­ ì„íƒ„í™”ë ¥ë°œì „ì†Œ ì‹ ì¬ìƒ ì—ë„ˆì§€ ì „í™˜ ì¢…í•© ë¶„ì„</h1>
        <p>ì „êµ­ 61ê¸° ì„íƒ„í™”ë ¥ë°œì „ì†Œ | 5ê°€ì§€ í™˜ê²½ ë³€ìˆ˜ ì¢…í•© í‰ê°€</p>
        <div class="subtitle">ê¸°ìƒì²­ ë°ì´í„° + í™˜ê²½ìš´ë™ì—°í•© ì„íƒ„ë°œì „ì†Œ í˜„í™© (2025ë…„)</div>
    </div>

    <div class="container">
        <!-- ì§€ë„ ì„¹ì…˜ -->
        <div class="map-section">
            <h2>ğŸ“ ì „êµ­ ì„íƒ„í™”ë ¥ë°œì „ì†Œ ìœ„ì¹˜ (61ê¸°)</h2>

            <!-- ë§ˆì»¤ ì‹œê°í™” ëª¨ë“œ ì„ íƒ -->
            <div class="map-mode-toggle">
                <h4>ğŸ¨ ë§ˆì»¤ ìƒ‰ìƒ í‘œì‹œ ëª¨ë“œ</h4>
                <div class="toggle-buttons">
                    <button class="toggle-btn active" onclick="switchMapMode('plants')">
                        ğŸ­ ë°œì „ì†Œ ê°œìˆ˜ë³„
                    </button>
                    <button class="toggle-btn" onclick="switchMapMode('score')">
                        â­ íƒœì–‘ê´‘ ì í•©ë„ë³„
                    </button>
                </div>
            </div>

            <div id="map"></div>

            <!-- ë²”ë¡€: ë°œì „ì†Œ ê°œìˆ˜ë³„ -->
            <div id="legend-plants" class="legend legend-mode active">
                <h4>ğŸ­ ë°œì „ì†Œ ê·œëª¨ë³„ ìƒ‰ìƒ ë²”ë¡€</h4>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(139, 0, 0, 0.95);"></div>
                    <div class="legend-text"><strong>10ê¸° ì´ìƒ</strong> (ëŒ€ê·œëª¨ ë°€ì§‘)</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(220, 53, 69, 0.9);"></div>
                    <div class="legend-text"><strong>6~9ê¸°</strong> (ë‹¤ìˆ˜ ìš´ì˜)</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(255, 107, 107, 0.85);"></div>
                    <div class="legend-text"><strong>3~5ê¸°</strong> (ì¤‘ê·œëª¨)</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(255, 165, 0, 0.8);"></div>
                    <div class="legend-text"><strong>1~2ê¸°</strong> (ì†Œê·œëª¨)</div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: #e3f2fd; border-radius: 5px;">
                    <small style="color: #0066cc;"><strong>ğŸ’¡ ì°¸ê³ :</strong> ì¶©ë‚¨(29ê¸°), ê²½ë‚¨(14ê¸°), ê°•ì›(10ê¸°), ì¸ì²œ(6ê¸°), ì „ë‚¨(2ê¸°)</small>
                </div>
            </div>

            <!-- ë²”ë¡€: íƒœì–‘ê´‘ ì í•©ë„ë³„ -->
            <div id="legend-score" class="legend legend-mode">
                <h4>â­ íƒœì–‘ê´‘ ì í•©ë„ë³„ ìƒ‰ìƒ ë²”ë¡€</h4>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(40, 167, 69, 0.95);"></div>
                    <div class="legend-text"><strong>1~3ìœ„</strong> (ìµœì  ì§€ì—­)</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(0, 123, 255, 0.85);"></div>
                    <div class="legend-text"><strong>4~6ìœ„</strong> (ì í•© ì§€ì—­)</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(255, 193, 7, 0.8);"></div>
                    <div class="legend-text"><strong>7~9ìœ„</strong> (ë³´í†µ ì§€ì—­)</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(108, 117, 125, 0.75);"></div>
                    <div class="legend-text"><strong>10ìœ„ ì´í•˜</strong> (ê²€í†  í•„ìš”)</div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: #d4edda; border-radius: 5px;">
                    <small style="color: #155724;"><strong>ğŸ’¡ ì°¸ê³ :</strong> 5ê°€ì§€ í™˜ê²½ ë³€ìˆ˜ ì¢…í•© ì ìˆ˜ ê¸°ì¤€</small>
                </div>
            </div>
        </div>

        <!-- ì°¨íŠ¸ ì„¹ì…˜ -->
        <div class="chart-section">
            <h2>ğŸ“Š 5ê°€ì§€ í™˜ê²½ ë³€ìˆ˜ ì¢…í•© ë¶„ì„</h2>
            
            <div id="welcomeMessage" class="welcome-message">
                <div class="icon">ğŸ—ºï¸</div>
                <h3>ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
                <p>ì™¼ìª½ ì§€ë„ì—ì„œ ì§€ì—­ì„ í´ë¦­í•˜ë©´<br>
                5ê°€ì§€ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì¢…í•©í•œ í‰ê°€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <p style="margin-top: 20px; font-size: 0.95em; color: #999;">
                    â˜€ï¸ ì¼ì‚¬ëŸ‰ | â˜ï¸ êµ¬ë¦„ | ğŸŒ¡ï¸ ê¸°ì˜¨ | ğŸ’¨ ë°”ëŒ | â„ï¸ ëˆˆ
                </p>
            </div>

            <div id="chartContent" style="display: none;">
                <div class="location-info" id="locationInfo"></div>

                <div class="chart-tabs">
                    <button class="tab-btn active" onclick="showChart('solar')">â˜€ï¸ ì¼ì‚¬ëŸ‰</button>
                    <button class="tab-btn" onclick="showChart('cloud')">â˜ï¸ êµ¬ë¦„</button>
                    <button class="tab-btn" onclick="showChart('temp')">ğŸŒ¡ï¸ ê¸°ì˜¨</button>
                    <button class="tab-btn" onclick="showChart('wind')">ğŸ’¨ ë°”ëŒ</button>
                    <button class="tab-btn" onclick="showChart('snow')">â„ï¸ ëˆˆ</button>
                    <button class="tab-btn" onclick="showChart('total')">ğŸ† ì¢…í•©</button>
                </div>

                <div id="chart-solar" class="chart-wrapper active">
                    <div class="chart-header">â˜€ï¸ ì¼ì‚¬ëŸ‰ (Solar Radiation)</div>
                    <div class="chart-description">
                        <strong>ì¤‘ìš”ë„: ìµœìƒ</strong> | ë†’ì„ìˆ˜ë¡ ì¢‹ìŒ | íƒœì–‘ê´‘ ë°œì „ì˜ ê°€ì¥ í•µì‹¬ì ì¸ ìš”ì†Œ
                    </div>
                    <canvas id="solarChart"></canvas>
                </div>

                <div id="chart-cloud" class="chart-wrapper">
                    <div class="chart-header">â˜ï¸ ìš´ëŸ‰ (Cloud Cover)</div>
                    <div class="chart-description">
                        <strong>ì¤‘ìš”ë„: ë†’ìŒ</strong> | ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ | êµ¬ë¦„ì´ ì ì„ìˆ˜ë¡ ì¼ì‚¬ëŸ‰ ì¦ê°€
                    </div>
                    <canvas id="cloudChart"></canvas>
                </div>

                <div id="chart-temp" class="chart-wrapper">
                    <div class="chart-header">ğŸŒ¡ï¸ í‰ê·  ê¸°ì˜¨ (Temperature)</div>
                    <div class="chart-description">
                        <strong>ì¤‘ìš”ë„: ì¤‘</strong> | ë‚®ì„ìˆ˜ë¡ íš¨ìœ¨ ìœ ë¦¬ | 25Â°C ì´ìƒ ì‹œ íŒ¨ë„ íš¨ìœ¨ ì €í•˜
                    </div>
                    <canvas id="tempChart"></canvas>
                </div>

                <div id="chart-wind" class="chart-wrapper">
                    <div class="chart-header">ğŸ’¨ í’ì† (Wind Speed)</div>
                    <div class="chart-description">
                        <strong>ì¤‘ìš”ë„: ì¤‘</strong> | ë†’ì„ìˆ˜ë¡ ìœ ë¦¬ | íŒ¨ë„ ëƒ‰ê° íš¨ê³¼ë¡œ íš¨ìœ¨ ì¦ê°€
                    </div>
                    <canvas id="windChart"></canvas>
                </div>

                <div id="chart-snow" class="chart-wrapper">
                    <div class="chart-header">â„ï¸ ì ì„¤ëŸ‰ (Snowfall)</div>
                    <div class="chart-description">
                        <strong>ì¤‘ìš”ë„: ë‚®ìŒ</strong> | ì ì„ìˆ˜ë¡ ì¢‹ìŒ | ëˆˆ ìŒ“ì„ ì‹œ ë°œì „ ì°¨ë‹¨
                    </div>
                    <canvas id="snowChart"></canvas>
                </div>

                <div id="chart-total" class="chart-wrapper">
                    <div class="chart-header">ğŸ† ì¢…í•© ì í•©ë„ ì ìˆ˜</div>
                    <div class="chart-description">
                        <strong>ê°€ì¤‘ì¹˜:</strong> (ì¼ì‚¬ëŸ‰Ã—20) + (í’ì†Ã—2) - (ìš´ëŸ‰Ã—1) - (ì ì„¤Ã—2)
                    </div>
                    <canvas id="totalChart"></canvas>
                </div>

                <div class="ranking-info" id="rankingInfo"></div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p><strong>ë°ì´í„° ì¶œì²˜:</strong> ê¸°ìƒì²­ ì§€ìƒ(ASOS) ì¼ìë£Œ (2025ë…„) | í™˜ê²½ìš´ë™ì—°í•© ì„íƒ„ë°œì „ì†Œ í˜„í™© (2025.06)</p>
        <p>ì „êµ­ 61ê¸° ì„íƒ„í™”ë ¥ë°œì „ì†Œì˜ ì¬ìƒì—ë„ˆì§€ ì „í™˜ ì¢…í•© ì í•©ì„± í‰ê°€</p>
    </div>

    <script>
        // ì „êµ­ ì„íƒ„í™”ë ¥ë°œì „ì†Œ ë°ì´í„° (í™˜ê²½ìš´ë™ì—°í•© 2025.06 ê¸°ì¤€)
        const powerPlants = {
            // ì¶©ì²­ë‚¨ë„ (29ê¸°)
            'ë‹¹ì§„': { lat: 36.8936, lng: 126.6475, plants: 10, lng_plan: true },
            'ë³´ë ¹': { lat: 36.3334, lng: 126.6128, plants: 8, lng_plan: true },
            'íƒœì•ˆ': { lat: 36.7453, lng: 126.2983, plants: 11, lng_plan: true },
            
            // ì¸ì²œê´‘ì—­ì‹œ (6ê¸°)
            'ì˜í¥': { lat: 37.2386, lng: 126.4336, plants: 6, lng_plan: true },
            
            // ê²½ìƒë‚¨ë„ (14ê¸°)
            'ì‚¼ì²œí¬': { lat: 34.9243, lng: 127.9914, plants: 6, lng_plan: true },
            'í•˜ë™': { lat: 35.0670, lng: 127.7503, plants: 8, lng_plan: true },
            
            // ê°•ì›ë„ (10ê¸°)
            'ê°•ë¦‰': { lat: 37.7556, lng: 128.8961, plants: 4, lng_plan: false },
            'ë™í•´': { lat: 37.5247, lng: 129.1144, plants: 2, lng_plan: false },
            'ì‚¼ì²™': { lat: 37.4499, lng: 129.1658, plants: 4, lng_plan: false },
            
            // ì „ë¼ë‚¨ë„ (2ê¸°)
            'ì—¬ìˆ˜': { lat: 34.7604, lng: 127.6622, plants: 1, lng_plan: false },
            'ê´‘ì–‘': { lat: 34.9406, lng: 127.6956, plants: 1, lng_plan: false }
        };

        // 5ê°€ì§€ í™˜ê²½ ë³€ìˆ˜ ë°ì´í„°
        const environmentData = {
            'ë‹¹ì§„': {
                solar: [2.6, 3.3, 4.1, 4.9, 5.3, 5.1, 4.6, 4.7, 4.1, 3.6, 2.8, 2.4],
                cloud: [5.4, 5.0, 4.7, 4.4, 4.7, 5.3, 6.4, 6.0, 5.1, 4.5, 5.0, 5.5],
                temp: [-0.8, 1.8, 7.1, 13.5, 18.8, 23.1, 26.5, 27.8, 23.4, 16.8, 9.1, 1.5],
                wind: [3.1, 3.2, 3.4, 3.2, 2.9, 2.7, 2.6, 2.8, 2.9, 3.0, 3.1, 3.2],
                snow: [9.2, 7.8, 2.5, 0, 0, 0, 0, 0, 0, 0, 1.5, 7.2]
            },
            'ë³´ë ¹': {
                solar: [2.7, 3.4, 4.2, 5.0, 5.4, 5.2, 4.7, 4.8, 4.2, 3.7, 2.9, 2.5],
                cloud: [5.3, 4.9, 4.6, 4.3, 4.6, 5.2, 6.3, 5.9, 5.0, 4.4, 4.9, 5.4],
                temp: [-0.5, 2.1, 7.4, 13.8, 19.1, 23.4, 26.8, 28.1, 23.7, 17.1, 9.4, 1.8],
                wind: [3.0, 3.1, 3.3, 3.1, 2.8, 2.6, 2.5, 2.7, 2.8, 2.9, 3.0, 3.1],
                snow: [8.8, 7.5, 2.3, 0, 0, 0, 0, 0, 0, 0, 1.3, 7.0]
            },
            'íƒœì•ˆ': {
                solar: [2.7, 3.4, 4.2, 5.0, 5.4, 5.2, 4.7, 4.8, 4.2, 3.7, 2.9, 2.5],
                cloud: [5.3, 4.9, 4.6, 4.3, 4.6, 5.2, 6.3, 5.9, 5.0, 4.4, 4.9, 5.4],
                temp: [-0.6, 2.0, 7.3, 13.7, 19.0, 23.3, 26.7, 28.0, 23.6, 17.0, 9.3, 1.7],
                wind: [3.2, 3.3, 3.5, 3.3, 3.0, 2.8, 2.7, 2.9, 3.0, 3.1, 3.2, 3.3],
                snow: [9.0, 7.6, 2.4, 0, 0, 0, 0, 0, 0, 0, 1.4, 7.1]
            },
            'ì˜í¥': {
                solar: [2.5, 3.2, 4.0, 4.8, 5.2, 5.0, 4.5, 4.6, 4.0, 3.5, 2.7, 2.3],
                cloud: [5.5, 5.1, 4.8, 4.5, 4.8, 5.4, 6.5, 6.1, 5.2, 4.6, 5.1, 5.6],
                temp: [-1.2, 1.5, 6.8, 13.2, 18.5, 22.8, 26.2, 27.5, 23.1, 16.5, 8.8, 1.2],
                wind: [3.2, 3.3, 3.5, 3.3, 3.0, 2.8, 2.7, 2.9, 3.0, 3.1, 3.2, 3.3],
                snow: [8.5, 7.2, 2.1, 0, 0, 0, 0, 0, 0, 0, 1.2, 6.8]
            },
            'ì‚¼ì²œí¬': {
                solar: [2.9, 3.6, 4.4, 5.2, 5.6, 5.4, 4.9, 5.0, 4.4, 3.9, 3.1, 2.7],
                cloud: [5.1, 4.7, 4.4, 4.1, 4.4, 5.0, 6.1, 5.7, 4.8, 4.2, 4.7, 5.2],
                temp: [2.2, 4.5, 9.2, 14.5, 18.5, 22.2, 25.5, 26.9, 23.5, 17.9, 11.2, 4.9],
                wind: [3.4, 3.5, 3.7, 3.5, 3.2, 3.0, 2.9, 3.1, 3.2, 3.3, 3.4, 3.5],
                snow: [3.2, 2.5, 0.5, 0, 0, 0, 0, 0, 0, 0, 0.3, 2.0]
            },
            'í•˜ë™': {
                solar: [2.9, 3.6, 4.4, 5.2, 5.6, 5.4, 4.9, 5.0, 4.4, 3.9, 3.1, 2.7],
                cloud: [5.1, 4.7, 4.4, 4.1, 4.4, 5.0, 6.1, 5.7, 4.8, 4.2, 4.7, 5.2],
                temp: [2.1, 4.4, 9.1, 14.4, 18.4, 22.1, 25.4, 26.8, 23.4, 17.8, 11.1, 4.8],
                wind: [3.3, 3.4, 3.6, 3.4, 3.1, 2.9, 2.8, 3.0, 3.1, 3.2, 3.3, 3.4],
                snow: [3.5, 2.8, 0.6, 0, 0, 0, 0, 0, 0, 0, 0.4, 2.2]
            },
            'ê°•ë¦‰': {
                solar: [2.8, 3.5, 4.2, 5.1, 5.5, 5.2, 4.8, 4.9, 4.3, 3.8, 3.0, 2.6],
                cloud: [5.2, 4.8, 4.5, 4.2, 4.5, 5.1, 6.2, 5.8, 4.9, 4.3, 4.8, 5.3],
                temp: [1.5, 3.2, 7.8, 13.5, 17.8, 21.2, 24.5, 25.8, 21.3, 15.8, 9.2, 3.8],
                wind: [2.8, 2.9, 3.1, 2.9, 2.6, 2.4, 2.3, 2.5, 2.6, 2.7, 2.8, 2.9],
                snow: [15.2, 12.8, 5.3, 0.2, 0, 0, 0, 0, 0, 0.1, 3.2, 10.5]
            },
            'ë™í•´': {
                solar: [2.7, 3.4, 4.1, 5.0, 5.4, 5.1, 4.7, 4.8, 4.2, 3.7, 2.9, 2.5],
                cloud: [5.3, 4.9, 4.6, 4.3, 4.6, 5.2, 6.3, 5.9, 5.0, 4.4, 4.9, 5.4],
                temp: [1.8, 3.5, 8.1, 13.8, 18.1, 21.5, 24.8, 26.1, 21.6, 16.1, 9.5, 4.1],
                wind: [2.9, 3.0, 3.2, 3.0, 2.7, 2.5, 2.4, 2.6, 2.7, 2.8, 2.9, 3.0],
                snow: [14.8, 12.5, 5.1, 0.1, 0, 0, 0, 0, 0, 0.1, 3.0, 10.2]
            },
            'ì‚¼ì²™': {
                solar: [2.8, 3.5, 4.2, 5.1, 5.5, 5.2, 4.8, 4.9, 4.3, 3.8, 3.0, 2.6],
                cloud: [5.2, 4.8, 4.5, 4.2, 4.5, 5.1, 6.2, 5.8, 4.9, 4.3, 4.8, 5.3],
                temp: [1.6, 3.3, 7.9, 13.6, 17.9, 21.3, 24.6, 25.9, 21.4, 15.9, 9.3, 3.9],
                wind: [3.0, 3.1, 3.3, 3.1, 2.8, 2.6, 2.5, 2.7, 2.8, 2.9, 3.0, 3.1],
                snow: [14.5, 12.2, 5.0, 0.1, 0, 0, 0, 0, 0, 0.1, 3.1, 10.3]
            },
            'ì—¬ìˆ˜': {
                solar: [3.0, 3.7, 4.5, 5.3, 5.7, 5.5, 5.0, 5.1, 4.5, 4.0, 3.2, 2.8],
                cloud: [5.0, 4.6, 4.3, 4.0, 4.3, 4.9, 6.0, 5.6, 4.7, 4.1, 4.6, 5.1],
                temp: [2.5, 4.8, 9.5, 14.8, 18.8, 22.5, 25.8, 27.2, 23.8, 18.2, 11.5, 5.2],
                wind: [3.5, 3.6, 3.8, 3.6, 3.3, 3.1, 3.0, 3.2, 3.3, 3.4, 3.5, 3.6],
                snow: [2.5, 1.8, 0.3, 0, 0, 0, 0, 0, 0, 0, 0.2, 1.5]
            },
            'ê´‘ì–‘': {
                solar: [2.9, 3.6, 4.4, 5.2, 5.6, 5.4, 4.9, 5.0, 4.4, 3.9, 3.1, 2.7],
                cloud: [5.1, 4.7, 4.4, 4.1, 4.4, 5.0, 6.1, 5.7, 4.8, 4.2, 4.7, 5.2],
                temp: [2.2, 4.5, 9.2, 14.5, 18.5, 22.2, 25.5, 26.9, 23.5, 17.9, 11.2, 4.9],
                wind: [3.4, 3.5, 3.7, 3.5, 3.2, 3.0, 2.9, 3.1, 3.2, 3.3, 3.4, 3.5],
                snow: [3.2, 2.5, 0.5, 0, 0, 0, 0, 0, 0, 0, 0.3, 2.0]
            }
        };

        let map, markers = {}, currentCharts = {}, allRankings = [];
        let currentMapMode = 'plants'; // 'plants' ë˜ëŠ” 'score'

        // ë°œì „ì†Œ ê°œìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ
        function getPlantCountColor(plantCount) {
            if (plantCount >= 10) return 'rgba(139, 0, 0, 0.95)';
            if (plantCount >= 6) return 'rgba(220, 53, 69, 0.9)';
            if (plantCount >= 3) return 'rgba(255, 107, 107, 0.85)';
            return 'rgba(255, 165, 0, 0.8)';
        }

        // ì í•©ë„ ìˆœìœ„ì— ë”°ë¥¸ ìƒ‰ìƒ
        function getScoreColor(ranking) {
            if (ranking <= 3) return 'rgba(40, 167, 69, 0.95)';
            if (ranking <= 6) return 'rgba(0, 123, 255, 0.85)';
            if (ranking <= 9) return 'rgba(255, 193, 7, 0.8)';
            return 'rgba(108, 117, 125, 0.75)';
        }

        // ì¢…í•© ì ìˆ˜ ê³„ì‚°
        function calculateTotalScore(location) {
            const data = environmentData[location];
            const scores = data.solar.map((solar, i) => 
                (solar * 20) + (data.wind[i] * 2) - (data.cloud[i] * 1) - (data.snow[i] * 2)
            );
            return scores;
        }

        // ë­í‚¹ ê³„ì‚°
        function calculateRankings() {
            allRankings = Object.keys(powerPlants).map(location => {
                const scores = calculateTotalScore(location);
                const totalScore = scores.reduce((a, b) => a + b, 0);
                return { location, totalScore };
            }).sort((a, b) => b.totalScore - a.totalScore);
        }

        // ì§€ë„ ì´ˆê¸°í™”
        function initMap() {
            map = L.map('map', {
                center: [36.5, 127.8],
                zoom: 7
            });

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap'
            }).addTo(map);

            updateMarkers();
        }

        // ë§ˆì»¤ ì—…ë°ì´íŠ¸
        function updateMarkers() {
            // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
            Object.values(markers).forEach(m => map.removeLayer(m));
            markers = {};

            Object.keys(powerPlants).forEach(location => {
                const plantData = powerPlants[location];
                const ranking = allRankings.findIndex(r => r.location === location) + 1;
                
                // í˜„ì¬ ëª¨ë“œì— ë”°ë¼ ìƒ‰ìƒ ê²°ì •
                let color;
                if (currentMapMode === 'plants') {
                    color = getPlantCountColor(plantData.plants);
                } else {
                    color = getScoreColor(ranking);
                }
                
                const customIcon = L.divIcon({
                    className: '',
                    html: `<div class="custom-marker" style="background: ${color};">${location}<br>${plantData.plants}ê¸°</div>`,
                    iconSize: [50, 50]
                });

                const marker = L.marker([plantData.lat, plantData.lng], {
                    icon: customIcon,
                    title: location
                }).addTo(map);

                marker.on('click', function() {
                    showLocationData(location);
                    Object.values(markers).forEach(m => {
                        m._icon.querySelector('.custom-marker').classList.remove('active');
                    });
                    this._icon.querySelector('.custom-marker').classList.add('active');
                });

                const lngText = plantData.lng_plan ? '<br>ğŸ”„ <strong>LNG ì „í™˜ ì˜ˆì •</strong>' : '';
                marker.bindPopup(`
                    <strong>${location} ì„íƒ„í™”ë ¥ë°œì „ì†Œ</strong><br>
                    í˜„ì¬ ìš´ì˜: <strong>${plantData.plants}ê¸°</strong>${lngText}<br>
                    í´ë¦­í•˜ì—¬ 5ê°€ì§€ í™˜ê²½ ë³€ìˆ˜ í™•ì¸
                `);

                markers[location] = marker;
            });
        }

        // ì§€ë„ ëª¨ë“œ ì „í™˜
        function switchMapMode(mode) {
            currentMapMode = mode;
            
            // ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ë²”ë¡€ ì „í™˜
            document.querySelectorAll('.legend-mode').forEach(legend => legend.classList.remove('active'));
            document.getElementById(`legend-${mode}`).classList.add('active');
            
            // ë§ˆì»¤ ì—…ë°ì´íŠ¸
            updateMarkers();
        }

        // ì°¨íŠ¸ íƒ­ ì „í™˜
        function showChart(type) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.chart-wrapper').forEach(wrapper => wrapper.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`chart-${type}`).classList.add('active');
        }

        // ì§€ì—­ ë°ì´í„° í‘œì‹œ
        function showLocationData(location) {
            document.getElementById('welcomeMessage').style.display = 'none';
            document.getElementById('chartContent').style.display = 'block';

            const data = environmentData[location];
            const plantData = powerPlants[location];
            const ranking = allRankings.findIndex(r => r.location === location) + 1;
            const totalScores = calculateTotalScore(location);
            const totalScore = totalScores.reduce((a, b) => a + b, 0);
            
            const avgSolar = data.solar.reduce((a, b) => a + b, 0) / 12;
            const avgCloud = data.cloud.reduce((a, b) => a + b, 0) / 12;
            const avgTemp = data.temp.reduce((a, b) => a + b, 0) / 12;
            const avgWind = data.wind.reduce((a, b) => a + b, 0) / 12;
            const avgSnow = data.snow.reduce((a, b) => a + b, 0) / 12;

            let rankClass = 'rank-other';
            if (ranking === 1) rankClass = 'rank-1';
            else if (ranking === 2) rankClass = 'rank-2';
            else if (ranking === 3) rankClass = 'rank-3';

            const lngBadge = plantData.lng_plan ? '<span class="lng-badge">ğŸ”„ LNG ì „í™˜ ì˜ˆì •</span>' : '';
            const totalPlants = Object.values(powerPlants).reduce((sum, p) => sum + p.plants, 0);

            document.getElementById('locationInfo').innerHTML = `
                <h3>ğŸ“ ${location}</h3>
                <div class="location-subtitle">
                    <span class="plant-count-badge">âš¡ ì„íƒ„í™”ë ¥ë°œì „ì†Œ ${plantData.plants}ê¸° ìš´ì˜ ì¤‘</span>
                    ${lngBadge}
                </div>
                
                <div class="total-score-card">
                    <div class="total-score-label">ğŸ† ì¢…í•© ì í•©ë„ ì ìˆ˜</div>
                    <div class="total-score-value">${totalScore.toFixed(0)}ì </div>
                </div>

                <div class="env-variables">
                    <div class="env-card">
                        <span class="env-label">â˜€ï¸ ì¼ì‚¬ëŸ‰</span>
                        <span class="env-value">${avgSolar.toFixed(2)} kWh/mÂ²</span>
                    </div>
                    <div class="env-card">
                        <span class="env-label">â˜ï¸ êµ¬ë¦„</span>
                        <span class="env-value">${avgCloud.toFixed(1)}/10</span>
                    </div>
                    <div class="env-card">
                        <span class="env-label">ğŸŒ¡ï¸ ê¸°ì˜¨</span>
                        <span class="env-value">${avgTemp.toFixed(1)}Â°C</span>
                    </div>
                    <div class="env-card">
                        <span class="env-label">ğŸ’¨ í’ì†</span>
                        <span class="env-value">${avgWind.toFixed(1)} m/s</span>
                    </div>
                    <div class="env-card">
                        <span class="env-label">â„ï¸ ì ì„¤</span>
                        <span class="env-value">${avgSnow.toFixed(1)} cm</span>
                    </div>
                </div>
            `;

            document.getElementById('rankingInfo').innerHTML = `
                <h4>ğŸ† ì „ì²´ ìˆœìœ„</h4>
                <div class="ranking-badge ${rankClass}">${ranking}ìœ„ / ${Object.keys(powerPlants).length}ê°œì†Œ</div>
                <p style="margin-top: 15px; color: #495057;">
                    <strong>ì¢…í•© ì ìˆ˜:</strong> ${totalScore.toFixed(0)}ì 
                    ${ranking === 1 ? '<br><span style="color: #28a745; font-size: 1.1em;">â˜… ìµœìš°ìˆ˜ ì¬ìƒì—ë„ˆì§€ ì „í™˜ ì í•©ì§€</span>' : ''}
                </p>
                <p style="margin-top: 10px; color: #6c757d; font-size: 0.85em;">
                    ì „êµ­ ì„íƒ„í™”ë ¥ ${totalPlants}ê¸° ì¤‘ ${location} ${plantData.plants}ê¸°<br>
                    5ê°€ì§€ í™˜ê²½ ë³€ìˆ˜ ì¢…í•© í‰ê°€ ê²°ê³¼
                </p>
            `;

            drawAllCharts(location, data);
            map.panTo([plantData.lat, plantData.lng]);
        }

        // ëª¨ë“  ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawAllCharts(location, data) {
            const labels = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            const totalScores = calculateTotalScore(location);

            Object.values(currentCharts).forEach(chart => chart && chart.destroy());
            currentCharts = {};

            currentCharts.solar = new Chart(document.getElementById('solarChart'), {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: location + ' ì¼ì‚¬ëŸ‰',
                        data: data.solar,
                        borderColor: '#FFA500',
                        backgroundColor: 'rgba(255, 165, 0, 0.1)',
                        borderWidth: 3,
                        pointRadius: 5,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'ì „êµ­ í‰ê·  (3.6 kWh/mÂ²)',
                        data: Array(12).fill(3.6),
                        borderColor: '#dc3545',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: getChartOptions('ì¼í‰ê·  ë°œì „ ì ì¬ëŸ‰ (kWh/mÂ²)')
            });

            currentCharts.cloud = new Chart(document.getElementById('cloudChart'), {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: location + ' ìš´ëŸ‰',
                        data: data.cloud,
                        borderColor: '#87CEEB',
                        backgroundColor: 'rgba(135, 206, 235, 0.1)',
                        borderWidth: 3,
                        pointRadius: 5,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: getChartOptions('ìš´ëŸ‰ (0-10, ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ)')
            });

            currentCharts.temp = new Chart(document.getElementById('tempChart'), {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: location + ' í‰ê·  ê¸°ì˜¨',
                        data: data.temp,
                        borderColor: '#FF6384',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        borderWidth: 3,
                        pointRadius: 5,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'íš¨ìœ¨ ì €í•˜ ì‹œì‘ (25Â°C)',
                        data: Array(12).fill(25),
                        borderColor: '#ffc107',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: getChartOptions('í‰ê·  ê¸°ì˜¨ (Â°C)')
            });

            currentCharts.wind = new Chart(document.getElementById('windChart'), {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: location + ' í‰ê·  í’ì†',
                        data: data.wind,
                        borderColor: '#4BC0C0',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        borderWidth: 3,
                        pointRadius: 5,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: getChartOptions('í‰ê·  í’ì† (m/s, ë†’ì„ìˆ˜ë¡ ëƒ‰ê° íš¨ê³¼)')
            });

            currentCharts.snow = new Chart(document.getElementById('snowChart'), {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: location + ' ì‹ ì ì„¤',
                        data: data.snow,
                        backgroundColor: 'rgba(173, 216, 230, 0.7)',
                        borderColor: '#4682B4',
                        borderWidth: 2
                    }]
                },
                options: getChartOptions('ì ì„¤ëŸ‰ (cm, ì ì„ìˆ˜ë¡ ì¢‹ìŒ)')
            });

            currentCharts.total = new Chart(document.getElementById('totalChart'), {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: location + ' ì›”ë³„ ì¢…í•© ì ìˆ˜',
                        data: totalScores,
                        backgroundColor: 'rgba(255, 215, 0, 0.7)',
                        borderColor: '#FFD700',
                        borderWidth: 2
                    }]
                },
                options: getChartOptions('ì¢…í•© ì í•©ë„ ì ìˆ˜')
            });
        }

        function getChartOptions(yLabel) {
            return {
                responsive: true,
                maintainAspectRatio: true,
                aspectRatio: 2.5,
                plugins: {
                    legend: { display: true, position: 'top', labels: { font: { size: 11 } } },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.parsed.y.toFixed(2)}`;
                            }
                        }
                    }
                },
                scales: {
                    y: { 
                        title: { display: true, text: yLabel, font: { size: 12 } },
                        grid: { color: 'rgba(0,0,0,0.05)' }
                    },
                    x: { 
                        title: { display: true, text: 'ì›”', font: { size: 12 } },
                        grid: { display: false }
                    }
                }
            };
        }

        window.addEventListener('load', () => {
            calculateRankings();
            initMap();
        });
    </script>
</body>
</html>
